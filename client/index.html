<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Web API endpoints return JSON metadata about music artists, albums, and tracks, directly from the Musicca">
    <link rel="shortcut icon"
        href="https://www.onlinelogomaker.com/blog/wp-content/uploads/2017/06/music-logo-design.jpg">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/css/uikit.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="./src/css/app.css">
    <title>Musicca</title>
    <style>
        .spinner {
            position: absolute;
            left: 50%;
            top: 50%;
            -webkit-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
            background: #111;
        }
    </style>
</head>

<body>
    <div id="root">
        <div class="container">
            <div class="row justify-content-center mt-5">
                <div class="col-xl-10 col-lg-10 col-md-12 col-sm-12 col-xs-12">
                    <div class="d-flex align-items-center justify-content-between">
                        <!-- Toggle canvas -->
                        <span uk-icon="icon: plus; ratio: 1.5" style="cursor: pointer;"
                            uk-toggle="target: #modal-post">
                            </span>
                        <!-- Search song -->
                        <section class="d-flex align-items-center">
                            <section>
                                <div class="uk-inline">
                                    <span class="uk-form-icon" uk-icon="icon: search"></span>
                                    <input class="uk-input  uk-form-width-large" v-model="keyword" v-on:input="searchSong" placeholder="Search a song eg. Title, Artist, Song writer or by Music #ID" type="text">
                                </div>
                            </section>
                            <section class="ml-3">
                                <button class="uk-button uk-button-default uk-button-small" type="button">
                                    <div class="d-flex align-items-center">
                                        <span class="mr-1">Filter by</span>
                                        <span uk-icon="icon: settings"></span>
                                    </div>
                                </button>
                                <div class="bg-primary" uk-dropdown="mode: click">
                                    <h5 class="text-white font-weight-light pointer" @click="filterBy('year')">
                                        <span v-if="sort.sortYear == true">Latest uploads</span>
                                        <span v-else>Oldest uploads</span>
                                    </h5>
                                    <h5 class="text-white font-weight-light pointer" @click="filterBy('title')">
                                        Song title
                                        <span v-if="sort.sortTitle == true">A-Z</span>
                                        <span v-else>Z-A</span>
                                    </h5>
                                    <h5 class="text-white font-weight-light pointer" @click="filterBy('artist')">
                                        Song artist
                                        <span v-if="sort.sortArtist == true">A-Z</span>
                                        <span v-else>Z-A</span>
                                    </h5>
                                    <h5 class="text-white font-weight-light pointer" @click="filterBy('writer')">
                                        Song writer
                                        <span v-if="sort.sortWriter == true">A-Z</span>
                                        <span v-else>Z-A</span>
                                    </h5>
                                    <h5 class="text-white font-weight-light pointer" @click="filterBy('genre')">
                                        Group by Genre</h5>
                                </div>
                            </section>
                        </section>
                    </div>
                    <div id="modal-post" uk-modal>
                        <div class="uk-modal-dialog uk-modal-body">
                            <h4 class="font-weight-light">
                                Add a new song
                            </h4>
                            <form @submit.prevent="postNewSong">
                                <section class="mt-2">
                                    <p class="p-0 m-0 mt-5 ml-2">Song title</p>
                                    <input 
                                        v-model="populateFieldsOnEdit.title" 
                                        class="uk-input uk-form-width-large"
                                        placeholder="Enter here..." type="text">

                                    <p class="p-0 m-0 mt-4 ml-2">Song artist</p>
                                    <input 
                                        v-model="populateFieldsOnEdit.artist" 
                                        class="uk-input uk-form-width-large mt-2" 
                                        placeholder="Enter here..." type="text">
    
                                    <p class="p-0 m-0 mt-4 ml-2">Song writer</p>
                                    <input 
                                        v-model="populateFieldsOnEdit.writer" 
                                        class="uk-input uk-form-width-large mt-2" 
                                        placeholder="Enter here..." 
                                        type="text">
                                    <p class="p-0 m-0 mt-4 ml-2">Song genre</p>
                                    <input 
                                        v-model="populateFieldsOnEdit.genre" 
                                        class="uk-input uk-form-width-large mt-2" 
                                        placeholder="Enter here..." type="text">
                                    <p class="p-0 m-0 mt-4 ml-2">Song release date</p>
                                    <input 
                                        v-model="populateFieldsOnEdit.releaseDate" 
                                        class="uk-input uk-form-width-large mt-2" 
                                        placeholder="Enter here..." 
                                        type="text">
                                </section>
                                <p class="uk-text-right mt-3">
                                    <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                                    <button class="uk-button uk-button-primary" type="submit">Add</button>
                                </p>
                            </form>
                        </div>
                    </div>
                    <table class="uk-table uk-table-hover uk-table-divider">
                        <thead>
                            <tr>
                                <th v-for="theadTitle in tableHeader">{{theadTitle}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(data, index) in songs">
                                <td>{{data.id}}</td>
                                <td>{{data.title}}</td>
                                <td>{{data.artist}}</td>
                                <td class="song-writer">{{data.writer}}</td>
                                <td>{{data.genre}}</td>
                                <td>{{data.releaseDate}}</td>
                                <td>
                                    <div class=" flex align-items-center">
                                        <span uk-icon="icon: file-edit" class="pointer"  uk-toggle="target: #modal-edit" @click="populateFields(data)"></span>
                                        <div id="modal-edit" uk-modal>
                                            <div class="uk-modal-dialog uk-modal-body">
                                                <h4 class="font-weight-light">
                                                    Edit <strong>{{ populateFieldsOnEdit.title }}  by {{ populateFieldsOnEdit.artist}}</strong>
                                                </h4>
                                                <form @submit.prevent="updateSong">
                                                    <section class="mt-2">
                                                        <p class="p-0 m-0 mt-5 ml-2">Song title</p>
                                                        <input 
                                                            v-model="populateFieldsOnEdit.title" 
                                                            class="uk-input uk-form-width-large"
                                                            placeholder="Enter here..." type="text">
                                                        <p class="p-0 m-0 mt-4 ml-2">Song artist</p>
                                                        <input 
                                                            v-model="populateFieldsOnEdit.artist" 
                                                            class="uk-input uk-form-width-large mt-2" 
                                                            placeholder="Enter here..." type="text">
                        
                                                        <p class="p-0 m-0 mt-4 ml-2">Song writer</p>
                                                        <input 
                                                            v-model="populateFieldsOnEdit.writer" 
                                                            class="uk-input uk-form-width-large mt-2" 
                                                            placeholder="Enter here..." 
                                                            type="text">
                                                        <p class="p-0 m-0 mt-4 ml-2">Song genre</p>
                                                        <input 
                                                            v-model="populateFieldsOnEdit.genre" 
                                                            class="uk-input uk-form-width-large mt-2" 
                                                            placeholder="Enter here..." type="text">
                                                        <p class="p-0 m-0 mt-4 ml-2">Song release date</p>
                                                        <input 
                                                            v-model="populateFieldsOnEdit.releaseDate" 
                                                            class="uk-input uk-form-width-large mt-2" 
                                                            placeholder="Enter here..." 
                                                            type="text">
                                                    </section>
                                                    <p class="uk-text-right mt-3">
                                                        <button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
                                                        <button class="uk-button uk-button-primary" type="submit">Save changes</button>
                                                    </p>
                                                </form>
                                            </div>
                                        </div>
                                        <span uk-icon="icon: trash" class="text-danger pointer" @click="removeSong(data)"></span>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <h3 class="font-weight-light text-center mt-5">{{songs.length}}
                        <span v-if="songs.length > 1">songs</span>
                        <span v-else>song</span>
                        <span>found in search result</span>
                    </h3>
                </div>
            </div>
        </div>
        <div id="snackbar" class="bg-success">
            <span class="ml-1 font-weight-light">
                <span id="snackbar-text"></span>
            </span>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.5.9/dist/js/uikit-icons.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.0/dist/axios.min.js"></script>
    <script>
        var initRoot = new Vue({
            el: '#root',
            data: {
                baseURL: "http://www.song-api-2020.somee.com/",
                songs: [],
                tableHeader: ['Music #ID', 'Title', 'Artist', 'Song writer', 'Genre', 'Released'],
                keyword: "",
                sort: {
                    sortArtist: true,
                    sortYear: true,
                    sortTitle: true,
                    sortWriter: true
                },
                populateFieldsOnEdit: {},
                newSong:{}
            },
            methods: {
                loadSongs: async function () {
                    await axios.get(this.baseURL + "api/song/all")
                        .then(res => {
                            this.songs = res.data;
                        })
                        .catch(err => console.log(err.data));
                },
                postNewSong: async function(){
                    await axios.post(this.baseURL + "api/song/create", this.populateFieldsOnEdit)
                        .then(res => {
                            this.loadSongs();
                            this.populateFieldsOnEdit = { ...null };
                        });
                },
                populateFields: async function(data){
                    let filter = this.songs.filter((value) => data.id === value.id)
                    this.populateFieldsOnEdit = {
                        id: filter[0].id,
                        title: filter[0].title,
                        artist: filter[0].artist,
                        writer: filter[0].writer,
                        genre: filter[0].genre,
                        releaseDate: filter[0].releaseDate
                    }
                },
                updateSong: async function() {
                        await axios.put(this.baseURL + "api/song/update", { ...this.populateFieldsOnEdit })
                        .then(res => this.loadSongs())
                        .catch(err => console.error(err))
                },
                searchSong: async function () {
                    //if keyword is null
                    if (this.keyword === null || this.keyword === "") return this.loadSongs();
                    // if keyword is a typeof number
                    if (!(this.keyword === this.keyword && this.keyword % 1 !== 0)) {
                        return await axios.get(this.baseURL + `api/song/find/${this.keyword}`)
                            .then(res => this.songs = [res.data])
                            .catch(() => console.error("Song Id not found"))
                    }
                    // if keyword is not a typeof number
                    if (isNaN(this.keyword) && this.keyword != null || this.keyword != "") {
                        return await axios.get(this.baseURL + `api/song/all?keyword=${this.keyword}`)
                            .then(res => {
                                this.songs = res.data;
                            })
                    }
                },
                removeSong: async function (data) {
                    await axios.delete(this.baseURL + `api/song/remove/${data.id}`)
                        .then(res => {
                            let targetClass = document.getElementById("snackbar");
                            targetClass.className = "show";
                            targetClass.innerHTML = data.title + " by " + data.artist + " was removed";
                            setTimeout(() => {
                                targetClass.className = targetClass.className.replace("show", "")
                            }, 2500);
                            this.loadSongs()
                        })
                        .catch(err => console.log(err.data));
                },
                filterBy: async function (value) {
                    if (this.songs) {
                        if (value === "year") {
                            if (this.sort.sortYear) {
                                this.songs = this.songs.sort((a, b) => b.releaseDate - a.releaseDate);
                                this.sort.sortYear = false;
                            } else if (!this.sort.sortYear) {
                                this.songs = this.songs.sort((a, b) => a.releaseDate - b.releaseDate);
                                this.sort.sortYear = true;
                            }
                        }
                        if (value === "artist") {
                            if (this.sort.sortArtist) {
                                this.songs.sort(function (a, b) {
                                    let HOLD_NAME = a.artist.toLowerCase(), nameB = b.artist.toLowerCase();
                                    if (nameA < nameB) return -1;
                                    if (nameA > nameB) return 1;
                                    return 0; //default return value (no sorting)
                                });
                                this.sort.sortArtist = false;
                            } else if (!this.sort.sortArtist) {
                                this.songs.sort(function (a, b) {
                                    let nameA = a.artist.toLowerCase(), nameB = b.artist.toLowerCase();
                                    if (nameA > nameB) return -1;
                                    else if (nameA < nameB) return 1;
                                    return 0; //default return value (no sorting)
                                });
                                this.sort.sortArtist = true;
                            }
                        }
                        if (value === "writer") {
                            if (this.sort.sortWriter) {
                                this.songs.sort(function (a, b) {
                                    let nameA = a.writer.toLowerCase(), nameB = b.writer.toLowerCase();
                                    if (nameA < nameB) return -1;
                                    if (nameA > nameB) return 1;
                                    return 0; //default return value (no sorting)
                                });
                                this.sort.sortWriter = false;
                            } else if (!this.sort.sortWriter) {
                                this.songs.sort(function (a, b) {
                                    let nameA = a.writer.toLowerCase(), nameB = b.writer.toLowerCase();
                                    if (nameA > nameB) return -1;
                                    else if (nameA < nameB) return 1;
                                    return 0; //default return value (no sorting)
                                });
                                this.sort.sortWriter = true;
                            }
                        }
                        if (value === "title") {
                            if (this.sort.sortTitle) {
                                this.songs.sort(function (a, b) {
                                    let nameA = a.title.toLowerCase(), nameB = b.title.toLowerCase();
                                    if (nameA < nameB) return -1;
                                    if (nameA > nameB) return 1;
                                    return 0; //default return value (no sorting)
                                });
                                this.sort.sortTitle = false;
                            } else if (!this.sort.sortTitle) {
                                this.songs.sort(function (a, b) {
                                    let nameA = a.title.toLowerCase(), nameB = b.title.toLowerCase();
                                    if (nameA > nameB) return -1;
                                    else if (nameA < nameB) return 1;
                                    return 0; //default return value (no sorting)
                                });
                                this.sort.sortTitle = true;
                            }
                        }
                        if (value === "genre") {
                            this.songs.sort(function (a, b) {
                                let nameA = a.genre.toLowerCase(), nameB = b.genre.toLowerCase();
                                if (nameA < nameB) return -1;
                                if (nameA > nameB) return 1;
                                return 0; //default return value (no sorting)
                            });
                        }
                    } else {
                        this.loadSongs();
                    }

                }
            },
            mounted: function () {
                this.loadSongs();
            }
        })
    </script>
</body>

</html>